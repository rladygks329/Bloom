<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.edu.blooming.BoardMapper">
	
	<!-- 게시글 리스트 조회 -->
	<select id="paging" resultType="BoardVO">
		select
			b.${boardId},
			b.${boardTitle},
			b.${boardContent},
			m.${memberName} ${authorName},
			b.${boardDateCreated},
			b.${boardViewCount},
			b.${boardAnswerCount},
			b.${boardLikeCount}
		from (
			select rownum rn, a.* 
			from (
					select * 
					from ${board}
					where board_parent_id = 0
					order by ${boardId} desc
				 ) a
			 ) b left join ${member} m on b.${memberId} = m.${memberId}
		where rn between #{start} and #{end}		
	</select>
	
	<!-- 게시글 조회 -->
	<select id="select_by_board_id" resultType="BoardVO">
		select 
			b.*, 
			m.${memberName} ${authorName}
		from ${board} b left join ${member} m on b.${memberId} = m.${memberId}
		where b.${boardId} = #{boardId} or b.${boardParentId} = #{boardId}
	</select>	
	
	<!-- 게시글 삭제: boardParentId 조회 -->
	<select id="select_question_parentId">
		select count(*) 
		from ${board}
		where ${boardParentId} = #{boardId}	
	</select>
	
	<!-- 게시글 삭제: 삭제처리 -->
	<delete id="delete_question">
		delete 
		from ${board}
		where ${boardId} = #{boardId}
	</delete>
	
	<!-- 게시글 삭제: memberId 업데이트 -->
	<update id="update_question">
		update ${board}
		set ${memberId} = -1
		where ${boardId} = #{boardId}
	</update>



	
	
	
	<!-- 게시글 등록 -->
	<insert id="insert">
		insert into ${board}
		(${memberId}, ${boardParentId}, ${boardTitle}, ${boardContent})
		values (#{memberId}, #{boardParentId}, #{boardTitle}, #{boardContent})		
	</insert>

	<!-- 게시글 수정 -->
	<update id="update">
		update ${board}
		set ${boardTitle} = #{boardTitle},
			${boardContent} = #{boardContent}
		where ${boardId} = #{boardId}	
	</update>

	<!-- 페이징처리: 게시글 총 개수 -->
	<select id="total_count" resultType="Integer">
		select count(*) total_cnt 
		from ${board}
		where board_parent_id = 0	
	</select>

	<!--  
		게시글 수정 시 답글에 제목여부(게시글만 제목있고 답글, 댓글은 제목이 업음)
		삭제시 아무것도 없으면 글이 삭제, 답글 있을 경우 memberId 정보만 업데이트하네,,
		답글도 댓글 달린 경우 똑같이 작동할 듯	
	-->

</mapper>